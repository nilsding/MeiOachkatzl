create table t1 (t1_a int, t1_b int, t1_c int, t1_d int);
create table t2 (t2_e int, t2_f int, t2_g int);
create table t3 (t3_x int, t3_y int);
insert into t1 values
(1,1,18,1), (2,1,25,1), (1,3,40,1), (2,1,15,4),
(4,2,24,4), (3,2,23,1), (1,2,40,2), (3,4,17,2),
(5,5,65,1), (2,3,70,3),  (1,4,35,3), (2,3,25,3);
insert into t2 values
(1,2,38), (2,3,15), (1,3,40), (1,4,35),
(2,2,70), (3,4,23), (5,5,12), (5,4,17),
(3,3,17), (4,2,24), (2,5,25), (5,1,65);
insert into t3 values
(1,25), (1,18), (2,15), (4,24),
(1,35), (3,23), (3,17), (2,15);
create view v1 as
(
select t3_x as v1_x, t3_y as v1_y from t3 where t3_x<=3
);
# conjunctive subformula : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where t1_c<25 and
(t1_a,t1_c) in (select t2_e,max(t2_g) from t2 where t2_e<5 group by t2_e);
t1_a	t1_b	t1_c	t1_d
4	2	24	4
3	2	23	1
select * from t1
where t1_c<25 and
(t1_a,t1_c) in (select t2_e,max(t2_g) from t2 where t2_e<5 group by t2_e);
t1_a	t1_b	t1_c	t1_d
4	2	24	4
3	2	23	1
explain select * from t1
where t1_c<25 and
(t1_a,t1_c) in (select t2_e,max(t2_g) from t2 where t2_e<5 group by t2_e);
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.t1_a,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where t1_c<25 and
(t1_a,t1_c) in (select t2_e,max(t2_g) from t2 where t2_e<5 group by t2_e);
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.t1_c < 25 and t1.t1_a is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["t2_e", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "`max(t2_g)` < 25",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5"
            }
          }
        }
      }
    }
  }
}
# extracted and formula : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where t1_c>55 and t1_b<4 and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
2	3	70	3
select * from t1
where t1_c>55 and t1_b<4 and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
2	3	70	3
explain select * from t1
where t1_c>55 and t1_b<4 and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.t1_a,test.t1.t1_b,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where t1_c>55 and t1_b<4 and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.t1_c > 55 and t1.t1_b < 4 and t1.t1_a is not null and t1.t1_b is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["t2_e", "t2_f", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_b", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "`max(t2_g)` > 55 and t2.t2_f < 4",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5"
            }
          }
        }
      }
    }
  }
}
# extracted or formula : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where (t1_c>60 or t1_c<25) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
4	2	24	4
2	3	70	3
select * from t1
where (t1_c>60 or t1_c<25) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
4	2	24	4
2	3	70	3
explain select * from t1
where (t1_c>60 or t1_c<25) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.t1_a,test.t1.t1_b,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where (t1_c>60 or t1_c<25) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.t1_c > 60 or t1.t1_c < 25) and t1.t1_a is not null and t1.t1_b is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["t2_e", "t2_f", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_b", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "`max(t2_g)` > 60 or `max(t2_g)` < 25",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5"
            }
          }
        }
      }
    }
  }
}
# extracted and-or formula : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where ((t1_c>60 or t1_c<25) and t1_b>2) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
2	3	70	3
select * from t1
where ((t1_c>60 or t1_c<25) and t1_b>2) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
2	3	70	3
explain select * from t1
where ((t1_c>60 or t1_c<25) and t1_b>2) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.t1_a,test.t1.t1_b,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where ((t1_c>60 or t1_c<25) and t1_b>2) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.t1_c > 60 or t1.t1_c < 25) and t1.t1_b > 2 and t1.t1_a is not null and t1.t1_b is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["t2_e", "t2_f", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_b", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "(`max(t2_g)` > 60 or `max(t2_g)` < 25) and t2.t2_f > 2",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5"
            }
          }
        }
      }
    }
  }
}
# conjunctive subformula : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where ((t1_a<2 or t1_d>3) and t1_b>1) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
4	2	24	4
1	2	40	2
select * from t1
where ((t1_a<2 or t1_d>3) and t1_b>1) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
4	2	24	4
1	2	40	2
explain select * from t1
where ((t1_a<2 or t1_d>3) and t1_b>1) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.t1_a,test.t1.t1_b,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where ((t1_a<2 or t1_d>3) and t1_b>1) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.t1_a < 2 or t1.t1_d > 3) and t1.t1_b > 1 and t1.t1_a is not null and t1.t1_b is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["t2_e", "t2_f", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_b", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "t2.t2_f > 1",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5"
            }
          }
        }
      }
    }
  }
}
# using view in subquery definition : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where t1_c>20 and
(t1_a,t1_c) in
(
select v1_x,max(v1_y)
from v1
where v1_x>1
group by v1_x
)
;
t1_a	t1_b	t1_c	t1_d
3	2	23	1
select * from t1
where t1_c>20 and
(t1_a,t1_c) in
(
select v1_x,max(v1_y)
from v1
where v1_x>1
group by v1_x
)
;
t1_a	t1_b	t1_c	t1_d
3	2	23	1
explain select * from t1
where t1_c>20 and
(t1_a,t1_c) in
(
select v1_x,max(v1_y)
from v1
where v1_x>1
group by v1_x
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.t1_a,test.t1.t1_c	1	
2	MATERIALIZED	t3	ALL	NULL	NULL	NULL	NULL	8	Using where; Using temporary
explain format=json select * from t1
where t1_c>20 and
(t1_a,t1_c) in
(
select v1_x,max(v1_y)
from v1
where v1_x>1
group by v1_x
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.t1_c > 20 and t1.t1_a is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["v1_x", "max(v1_y)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "`max(v1_y)` > 20",
          "temporary_table": {
            "table": {
              "table_name": "t3",
              "access_type": "ALL",
              "rows": 8,
              "filtered": 100,
              "attached_condition": "t3.t3_x > 1 and t3.t3_x <= 3"
            }
          }
        }
      }
    }
  }
}
# using equality : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1,v1
where t1_c>20 and t1_c=v1_y and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d	v1_x	v1_y
3	2	23	1	3	23
select * from t1,v1
where t1_c>20 and t1_c=v1_y and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d	v1_x	v1_y
3	2	23	1	3	23
explain select * from t1,v1
where t1_c>20 and t1_c=v1_y and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where; Using join buffer (flat, BNL join)
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.t1_a,test.t3.t3_y	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1,v1
where t1_c>20 and t1_c=v1_y and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t3",
      "access_type": "ALL",
      "rows": 8,
      "filtered": 100,
      "attached_condition": "t3.t3_y > 20 and t3.t3_x <= 3 and t3.t3_y is not null"
    },
    "block-nl-join": {
      "table": {
        "table_name": "t1",
        "access_type": "ALL",
        "rows": 12,
        "filtered": 100
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "t1.t1_c = t3.t3_y and t1.t1_a is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["t2_e", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t3.t3_y"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "`max(t2_g)` > 20",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5"
            }
          }
        }
      }
    }
  }
}
# conjunctive subformula : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where t1_a<2 and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
1	3	40	1
1	2	40	2
select * from t1
where t1_a<2 and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
1	3	40	1
1	2	40	2
explain select * from t1
where t1_a<2 and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.t1_a,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where t1_a<2 and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.t1_a < 2 and t1.t1_a is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["t2_e", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5 and t2.t2_e < 2"
            }
          }
        }
      }
    }
  }
}
# extracted and formula : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where t1_a>2 and t1_a<5 and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
4	2	24	4
3	2	23	1
select * from t1
where t1_a>2 and t1_a<5 and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
4	2	24	4
3	2	23	1
explain select * from t1
where t1_a>2 and t1_a<5 and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.t1_a,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where t1_a>2 and t1_a<5 and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.t1_a > 2 and t1.t1_a < 5 and t1.t1_a is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["t2_e", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5 and t2.t2_e > 2 and t2.t2_e < 5"
            }
          }
        }
      }
    }
  }
}
# extracted or formula : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where (t1_a<2 or t1_a>=4) and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
1	3	40	1
4	2	24	4
1	2	40	2
select * from t1
where (t1_a<2 or t1_a>=4) and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
1	3	40	1
4	2	24	4
1	2	40	2
explain select * from t1
where (t1_a<2 or t1_a>=4) and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.t1_a,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where (t1_a<2 or t1_a>=4) and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.t1_a < 2 or t1.t1_a >= 4) and t1.t1_a is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["t2_e", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5 and (t2.t2_e < 2 or t2.t2_e >= 4)"
            }
          }
        }
      }
    }
  }
}
# extracted and-or formula : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where ((t1_a<2 or t1_a=5) and t1_b>3) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e,t2_f
)
;
t1_a	t1_b	t1_c	t1_d
1	4	35	3
select * from t1
where ((t1_a<2 or t1_a=5) and t1_b>3) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e,t2_f
)
;
t1_a	t1_b	t1_c	t1_d
1	4	35	3
explain select * from t1
where ((t1_a<2 or t1_a=5) and t1_b>3) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e,t2_f
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.t1_a,test.t1.t1_b,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where ((t1_a<2 or t1_a=5) and t1_b>3) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e,t2_f
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.t1_a < 2 or t1.t1_a = 5) and t1.t1_b > 3 and t1.t1_a is not null and t1.t1_b is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["t2_e", "t2_f", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_b", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5 and (t2.t2_e < 2 or t2.t2_e = 5) and t2.t2_f > 3"
            }
          }
        }
      }
    }
  }
}
# extracted and-or formula : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where ((t1_a<2 or t1_a=5) and t1_b>3) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e,t2_f
)
;
t1_a	t1_b	t1_c	t1_d
1	4	35	3
select * from t1
where ((t1_a<2 or t1_a=5) and t1_b>3) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e,t2_f
)
;
t1_a	t1_b	t1_c	t1_d
1	4	35	3
explain select * from t1
where ((t1_a<2 or t1_a=5) and t1_b>3) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e,t2_f
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.t1_a,test.t1.t1_b,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where ((t1_a<2 or t1_a=5) and t1_b>3) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e,t2_f
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.t1_a < 2 or t1.t1_a = 5) and t1.t1_b > 3 and t1.t1_a is not null and t1.t1_b is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["t2_e", "t2_f", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_b", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5 and (t2.t2_e < 2 or t2.t2_e = 5) and t2.t2_f > 3"
            }
          }
        }
      }
    }
  }
}
# conjunctive subformula : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where ((t1_b<3 or t1_d>2) and t1_a<2) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
1	2	40	2
select * from t1
where ((t1_b<3 or t1_d>2) and t1_a<2) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
1	2	40	2
explain select * from t1
where ((t1_b<3 or t1_d>2) and t1_a<2) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.t1_a,test.t1.t1_b,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where ((t1_b<3 or t1_d>2) and t1_a<2) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.t1_b < 3 or t1.t1_d > 2) and t1.t1_a < 2 and t1.t1_a is not null and t1.t1_b is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["t2_e", "t2_f", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_b", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5 and t2.t2_e < 2"
            }
          }
        }
      }
    }
  }
}
# using equalities : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where t1_d=1 and t1_a=t1_d and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
1	3	40	1
select * from t1
where t1_d=1 and t1_a=t1_d and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
1	3	40	1
explain select * from t1
where t1_d=1 and t1_a=t1_d and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	const,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where
explain format=json select * from t1
where t1_d=1 and t1_a=t1_d and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.t1_a = 1 and t1.t1_d = 1 and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["t2_e", "max(t2_g)"],
      "ref": ["const", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "table": {
            "table_name": "t2",
            "access_type": "ALL",
            "rows": 12,
            "filtered": 100,
            "attached_condition": "t2.t2_e = 1"
          }
        }
      }
    }
  }
}
# using equality : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where t1_d>1 and t1_a=t1_d and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
4	2	24	4
select * from t1
where t1_d>1 and t1_a=t1_d and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
4	2	24	4
explain select * from t1
where t1_d>1 and t1_a=t1_d and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.t1_a,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where t1_d>1 and t1_a=t1_d and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.t1_d = t1.t1_a and t1.t1_a > 1 and t1.t1_a is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["t2_e", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5 and t2.t2_e > 1"
            }
          }
        }
      }
    }
  }
}
# using view in subquery definition : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where t1_a<3 and
(t1_a,t1_c) in
(
select v1_x,max(v1_y)
from v1
where v1_x>1
group by v1_x
)
;
t1_a	t1_b	t1_c	t1_d
2	1	15	4
select * from t1
where t1_a<3 and
(t1_a,t1_c) in
(
select v1_x,max(v1_y)
from v1
where v1_x>1
group by v1_x
)
;
t1_a	t1_b	t1_c	t1_d
2	1	15	4
explain select * from t1
where t1_a<3 and
(t1_a,t1_c) in
(
select v1_x,max(v1_y)
from v1
where v1_x>1
group by v1_x
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t1.t1_a,test.t1.t1_c	1	
2	MATERIALIZED	t3	ALL	NULL	NULL	NULL	NULL	8	Using where; Using temporary
explain format=json select * from t1
where t1_a<3 and
(t1_a,t1_c) in
(
select v1_x,max(v1_y)
from v1
where v1_x>1
group by v1_x
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "t1.t1_a < 3 and t1.t1_a is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["v1_x", "max(v1_y)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t3",
              "access_type": "ALL",
              "rows": 8,
              "filtered": 100,
              "attached_condition": "t3.t3_x > 1 and t3.t3_x <= 3 and t3.t3_x < 3"
            }
          }
        }
      }
    }
  }
}
# using equality : pushing into WHERE
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1,v1
where t1_a=v1_x and v1_x<2 and v1_y>30 and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d	v1_x	v1_y
1	3	40	1	1	35
1	2	40	2	1	35
select * from t1,v1
where t1_a=v1_x and v1_x<2 and v1_y>30 and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d	v1_x	v1_y
1	3	40	1	1	35
1	2	40	2	1	35
explain select * from t1,v1
where t1_a=v1_x and v1_x<2 and v1_y>30 and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t3	ALL	NULL	NULL	NULL	NULL	8	Using where
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where; Using join buffer (flat, BNL join)
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	8	test.t3.t3_x,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1,v1
where t1_a=v1_x and v1_x<2 and v1_y>30 and
(t1_a,t1_c) in
(
select t2_e,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t3",
      "access_type": "ALL",
      "rows": 8,
      "filtered": 100,
      "attached_condition": "t3.t3_x < 2 and t3.t3_y > 30 and t3.t3_x <= 3 and t3.t3_x is not null"
    },
    "block-nl-join": {
      "table": {
        "table_name": "t1",
        "access_type": "ALL",
        "rows": 12,
        "filtered": 100
      },
      "buffer_type": "flat",
      "buffer_size": "256Kb",
      "join_type": "BNL",
      "attached_condition": "t1.t1_a = t3.t3_x and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "8",
      "used_key_parts": ["t2_e", "max(t2_g)"],
      "ref": ["test.t3.t3_x", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5 and t2.t2_e <= 3"
            }
          }
        }
      }
    }
  }
}
# conjunctive subformula : pushing into WHERE
# extracted or formula : pushing into HAVING
set statement optimizer_switch='condition_pushdown_for_subquery=off' for select * from t1
where ((t1_b<3 or t1_b=4) and t1_a<3) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
1	2	40	2
select * from t1
where ((t1_b<3 or t1_b=4) and t1_a<3) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
t1_a	t1_b	t1_c	t1_d
1	2	40	2
explain select * from t1
where ((t1_b<3 or t1_b=4) and t1_a<3) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	PRIMARY	t1	ALL	NULL	NULL	NULL	NULL	12	Using where
1	PRIMARY	<subquery2>	eq_ref	distinct_key	distinct_key	12	test.t1.t1_a,test.t1.t1_b,test.t1.t1_c	1	
2	MATERIALIZED	t2	ALL	NULL	NULL	NULL	NULL	12	Using where; Using temporary
explain format=json select * from t1
where ((t1_b<3 or t1_b=4) and t1_a<3) and
(t1_a,t1_b,t1_c) in
(
select t2_e,t2_f,max(t2_g)
from t2
where t2_e<5
group by t2_e
)
;
EXPLAIN
{
  "query_block": {
    "select_id": 1,
    "table": {
      "table_name": "t1",
      "access_type": "ALL",
      "rows": 12,
      "filtered": 100,
      "attached_condition": "(t1.t1_b < 3 or t1.t1_b = 4) and t1.t1_a < 3 and t1.t1_a is not null and t1.t1_b is not null and t1.t1_c is not null"
    },
    "table": {
      "table_name": "<subquery2>",
      "access_type": "eq_ref",
      "possible_keys": ["distinct_key"],
      "key": "distinct_key",
      "key_length": "12",
      "used_key_parts": ["t2_e", "t2_f", "max(t2_g)"],
      "ref": ["test.t1.t1_a", "test.t1.t1_b", "test.t1.t1_c"],
      "rows": 1,
      "filtered": 100,
      "materialized": {
        "unique": 1,
        "query_block": {
          "select_id": 2,
          "having_condition": "t2.t2_f < 3 or t2.t2_f = 4",
          "temporary_table": {
            "table": {
              "table_name": "t2",
              "access_type": "ALL",
              "rows": 12,
              "filtered": 100,
              "attached_condition": "t2.t2_e < 5 and t2.t2_e < 3"
            }
          }
        }
      }
    }
  }
}
drop table t1,t2,t3;
drop view v1;
